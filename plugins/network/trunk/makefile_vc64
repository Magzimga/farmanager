OUTDIR = final.64.vc
OBJDIR = $(OUTDIR)\obj
NAME = Network
DLLNAME = $(NAME).dll
DLLFULLNAME = $(OUTDIR)\$(DLLNAME)
DEF = $(NAME).vc.def
MAP = $(OUTDIR)\$(NAME).map

LIBS = ..\common\libCRT64.lib chkstk.obj kernel32.lib user32.lib gdi32.lib advapi32.lib mpr.lib
CPP_PROJ=/nologo /c /Zp8 /J /Wp64 /GS- /Gr /GR- /EHs-c- /LD /Fo"$(OBJDIR)\\" /I"..\common"
LINK_FLAGS=/nologo /dll /release /merge:.rdata=.text /machine:amd64 /opt:nowin98 /noentry /nodefaultlib /def:"$(DEF)" /map:"$(MAP)" /out:"$(DLLFULLNAME)" $(LIBS)

LINK_OBJS = $(OBJDIR)\Network.obj \
$(OBJDIR)\NetCfg.obj \
$(OBJDIR)\NetClass.obj \
$(OBJDIR)\NetCommon.obj \
$(OBJDIR)\NetFavorites.obj \
$(OBJDIR)\NetMix.obj \
$(OBJDIR)\NetNT.obj \
$(OBJDIR)\NetReg.obj \
$(OBJDIR)\$(NAME).res

ALL: $(OUTDIR) $(OBJDIR) $(DLLFULLNAME)

$(DLLFULLNAME) : $(LINK_OBJS)
	link @<<
	$(LINK_FLAGS) $(LINK_OBJS)
<<
	@copy /Y *.hlf $(OUTDIR) > nul
	@copy /Y *.lng $(OUTDIR) > nul

.cpp{$(OBJDIR)}.obj::
	cl @<<
	$(CPP_PROJ) $<
<<

$(OBJDIR)\$(NAME).res: $(NAME).rc ..\common\farversion.hpp
	@rc /fo"$(OBJDIR)\$(NAME).res" $(NAME).rc

$(OBJDIR)\NetCfg.obj : NetCfg.cpp NetCfg.hpp NetCommon.hpp ..\common\plugin.hpp \
  netlng.hpp NetMacros.hpp NetFavorites.hpp NetClass.hpp NetReg.hpp
$(OBJDIR)\NetClass.obj : NetClass.cpp NetClass.hpp ..\common\plugin.hpp \
  NetFavorites.hpp NetCommon.hpp netlng.hpp NetMacros.hpp NetReg.hpp \
  NetCfg.hpp
$(OBJDIR)\NetCommon.obj : NetCommon.cpp NetCommon.hpp ..\common\plugin.hpp netlng.hpp \
  NetMacros.hpp NetReg.hpp NetCfg.hpp NetFavorites.hpp NetClass.hpp
$(OBJDIR)\NetFavorites.obj : NetFavorites.cpp NetFavorites.hpp NetClass.hpp \
  ..\common\plugin.hpp NetCommon.hpp netlng.hpp NetMacros.hpp NetReg.hpp
$(OBJDIR)\NetMix.obj : NetMix.cpp NetCommon.hpp ..\common\plugin.hpp netlng.hpp \
  NetMacros.hpp
$(OBJDIR)\NetNT.obj : NetNT.cpp NetClass.hpp ..\common\plugin.hpp NetCommon.hpp \
  netlng.hpp NetMacros.hpp
$(OBJDIR)\NetReg.obj : NetReg.cpp NetReg.hpp NetCommon.hpp ..\common\plugin.hpp \
  netlng.hpp NetMacros.hpp
$(OBJDIR)\Network.obj : Network.cpp Network.hpp NetCommon.hpp ..\common\plugin.hpp \
  netlng.hpp NetMacros.hpp NetClass.hpp

$(OBJDIR): $(OUTDIR)
	@if not exist "$(OBJDIR)\$(NULL)" mkdir "$(OBJDIR)"

$(OUTDIR):
	@if not exist "$(OUTDIR)\$(NULL)" mkdir "$(OUTDIR)"
